---
dist: trusty
language: node_js
node_js:
  - 9
cache:
  yarn: true
  directories:
  - node_modules
install: true
stages:
  - install
  - eslint-coverage
  - build
  - name: npm-release
    if: tag =~ ^v(\d{1}).(\d{1}).(\d{1})$
  - github-pages
jobs:
  include:
    - stage: install
      script: yarn

    - stage: eslint-coverage
      script: yarn eslint
    -
      script: yarn test:ci

    - stage: build
      script: yarn build
    -
      script: yarn docs
    -
      script: yarn bundle:check

    - stage: npm-release
      node_js: 9
      script: echo "Deploying to npm..."
      deploy:
        api_key: $NPM_API_KEY
        email: "filippo@sarzana.me"
        gem: travis-build-stages-demo
        provider: npm
        skip_cleanup: true
        on:
          tags: true

    - stage: github-pages
      node_js: 9
      script: echo "Deploying Github Pages..."
      deploy:
        github_token: $GITHUB_TOKEN
        provider: pages
        skip_cleanup: true
        local_dir: docs
        on:
          branch: master
